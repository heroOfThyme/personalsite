---
import type { ImageMetadata } from 'astro';
import { Icon } from 'astro-icon/components';
import Image from '~/components/common/Image.astro';

import { APP_BLOG } from 'astrowind:config';
import type { Post } from '~/types';

import { getPermalink } from '~/utils/permalinks';
import { findImage } from '~/utils/images';
import { getFormattedDate } from '~/utils/utils';

export interface Props {
  post: Post;
}

const { post } = Astro.props;
const image = (await findImage(post.image)) as ImageMetadata | undefined;

const link = APP_BLOG?.post?.isEnabled ? getPermalink(post.permalink, 'post') : '';
---

<article class="blog-card">
  {image && (
    <a href={link ?? 'javascript:void(0)'} class="blog-image-wrapper">
      <div class="blog-image-container">
        <Image
          src={image}
          class="blog-image"
          widths={[400, 900]}
          width={900}
          sizes="(max-width: 900px) 400px, 900px"
          alt={post.title}
          aspectRatio="16:9"
          loading="lazy"
          decoding="async"
        />
        <div class="image-overlay"></div>
      </div>
    </a>
  )}

  <div class="blog-content">
    <div class="blog-meta">
      <span class="meta-item">
        <Icon name="tabler:clock" class="meta-icon" />
        <time datetime={String(post.publishDate)}>{getFormattedDate(post.publishDate)}</time>
      </span>
      {post.author && (
        <span class="meta-item">
          <Icon name="tabler:user" class="meta-icon" />
          <span>{post.author.replaceAll('-', ' ')}</span>
        </span>
      )}
      {post.category && (
        <a href={getPermalink(post.category.slug, 'category')} class="meta-category">
          <Icon name="tabler:folder" class="meta-icon" />
          {post.category.title}
        </a>
      )}
    </div>

    <h2 class="blog-title">
      {link ? (
        <a href={link} class="blog-title-link">
          {post.title}
        </a>
      ) : (
        post.title
      )}
    </h2>

    {post.excerpt && <p class="blog-excerpt">{post.excerpt}</p>}

    {link && (
      <a href={link} class="read-more">
        Read More
        <Icon name="tabler:arrow-right" class="read-more-icon" />
      </a>
    )}
  </div>
</article>

<style>
  .blog-card {
    background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.05), transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.05), transparent 50%), #0f172a;
    border: 1px solid rgba(168, 85, 247, 0.2);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .blog-card:hover {
    border-color: rgba(168, 85, 247, 0.4);
    transform: translateY(-4px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
  }

  .blog-image-wrapper {
    display: block;
    position: relative;
    overflow: hidden;
  }

  .blog-image-container {
    position: relative;
    width: 100%;
    height: 250px;
    overflow: hidden;
  }

  .blog-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .blog-card:hover .blog-image {
    transform: scale(1.05);
  }

  .image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, transparent 0%, rgba(15, 23, 42, 0.8) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .blog-card:hover .image-overlay {
    opacity: 1;
  }

  .blog-content {
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    flex: 1;
  }

  .blog-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.875rem;
    color: #94a3b8;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .meta-icon {
    width: 1rem;
    height: 1rem;
    color: #ec4899;
  }

  .meta-category {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: #94a3b8;
    text-decoration: none;
    padding: 0.25rem 0.75rem;
    background: rgba(168, 85, 247, 0.1);
    border: 1px solid rgba(168, 85, 247, 0.2);
    border-radius: 50px;
    font-size: 0.75rem;
    transition: all 0.2s ease;
  }

  .meta-category:hover {
    color: #ec4899;
    border-color: rgba(236, 72, 153, 0.4);
    background: rgba(236, 72, 153, 0.1);
  }

  .blog-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
    margin: 0;
    line-height: 1.3;
  }

  .blog-title-link {
    color: white;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .blog-title-link:hover {
    color: #ec4899;
  }

  .blog-excerpt {
    font-size: 0.9375rem;
    color: #94a3b8;
    line-height: 1.6;
    margin: 0;
    flex: 1;
  }

  .read-more {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: #a855f7;
    font-size: 0.875rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
    margin-top: auto;
  }

  .read-more:hover {
    color: #ec4899;
  }

  .read-more-icon {
    width: 1rem;
    height: 1rem;
    transition: transform 0.2s ease;
  }

  .read-more:hover .read-more-icon {
    transform: translateX(4px);
  }

  @media (max-width: 768px) {
    .blog-content {
      padding: 1.5rem;
    }

    .blog-title {
      font-size: 1.25rem;
    }

    .blog-image-container {
      height: 200px;
    }
  }
</style>
